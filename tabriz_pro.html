<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TABRIZ B2B | –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª –†–∞—Å–∫—Ä–æ–π</title>
    <style>
        :root { 
            --gold: #d4af37; --accent: #b8860b; --bg: #0f172a; 
            --panel: #1e293b; --text: #f1f5f9; --border: #334155;
        }
        
        body { 
            margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text);
            display: flex; height: 100vh; overflow: hidden;
        }

        /* Sidebar –ú–µ–Ω—é */
        .sidebar { 
            width: 280px; background: var(--panel); border-right: 1px solid var(--border);
            display: flex; flex-direction: column; padding: 25px; box-shadow: 10px 0 30px rgba(0,0,0,0.3);
        }
        .sidebar h2 { color: var(--gold); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 40px; font-size: 20px; text-align: center; }
        
        .nav-item { 
            padding: 15px; color: #94a3b8; border-radius: 12px; margin-bottom: 10px; 
            cursor: pointer; transition: 0.3s; display: flex; align-items: center; font-weight: 500;
        }
        .nav-item:hover, .nav-item.active { background: rgba(212, 175, 55, 0.15); color: var(--gold); }
        .nav-item span { margin-right: 15px; font-size: 20px; }

        /* Main Area */
        .main { flex: 1; padding: 40px; overflow-y: auto; position: relative; }
        .screen { display: none; animation: fadeIn 0.4s ease; }
        .screen.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card { 
            background: rgba(30, 41, 59, 0.8); backdrop-filter: blur(10px); 
            border: 1px solid var(--border); border-radius: 20px; padding: 30px; margin-bottom: 25px;
        }

        /* B2B Table */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { color: var(--gold); text-align: left; padding: 12px; border-bottom: 2px solid var(--border); }
        td { padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        
        input, select { 
            background: #0f172a; border: 1px solid var(--border); color: white; 
            padding: 10px; border-radius: 8px; width: 100%; outline: none;
        }
        input:focus { border-color: var(--gold); }

        .btn { 
            background: linear-gradient(135deg, var(--gold), var(--accent)); color: black;
            padding: 15px 30px; border: none; border-radius: 10px; cursor: pointer; 
            font-weight: bold; text-transform: uppercase; width: 100%; transition: 0.3s;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(212, 175, 55, 0.2); }

        canvas { background: white; border-radius: 15px; width: 100%; margin-bottom: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .sheet-num { background: var(--gold); color: black; padding: 5px 15px; border-radius: 5px; font-weight: bold; margin-bottom: 10px; display: inline-block; }
    </style>
</head>
<body>

    <div class="sidebar">
        <h2>TABRIZ PRO</h2>
        <div class="nav-item active" onclick="showScr('scr-acc')"><span>üë§</span> –ê–∫–∫–∞—É–Ω—Ç</div>
        <div class="nav-item" onclick="showScr('scr-order')"><span>‚ûï</span> –Ø–Ω–≥–∏ –ë—É—é—Ä—Ç–º–∞</div>
        <div class="nav-item" onclick="showScr('scr-history')"><span>üìú</span> –ó–∞–∫–∞–∑–ª–∞—Ä —Ç–∞—Ä–∏—Ö–∏</div>
        <div class="nav-item" onclick="window.open('https://t.me/raspilnaya_bot')"><span>üõ†</span> –Å—Ä–¥–∞–º</div>
        <div class="nav-item" style="margin-top: auto;" onclick="location.reload()"><span>üö™</span> –ß–∏“õ–∏—à</div>
    </div>

    <div class="main">

        <div id="scr-acc" class="screen active">
            <div class="card">
                <h1>–•–∞–π—Ä–ª–∏ –∫—É–Ω, –ú–µ–±–µ–ª—å—á–∏!</h1>
                <p style="color: #94a3b8;">B2B –ø–æ—Ä—Ç–∞–ª–∏–≥–∞ —Ö—É—à –∫–µ–ª–∏–±—Å–∏–∑. –ë—É –µ—Ä–¥–∞ —Å–∏–∑ —û–ª—á–∞–º–ª–∞—Ä–Ω–∏ –±–µ—Ä–∏—à–∏–Ω–≥–∏–∑ –≤–∞ —Ç–∞–π—ë—Ä —Ä–∞—Å–∫—Ä–æ–π–Ω–∏ –æ–ª–∏—à–∏–Ω–≥–∏–∑ –º—É–º–∫–∏–Ω.</p>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px;">
                    <div class="card" style="margin:0; border-color: var(--gold);">
                        <small>–ë–∞–ª–∞–Ω—Å–∏–Ω–≥–∏–∑:</small>
                        <h2>4,500,000 UZS</h2>
                    </div>
                    <div class="card" style="margin:0;">
                        <small>–ê–∫—Ç–∏–≤ –∑–∞–∫–∞–∑–ª–∞—Ä:</small>
                        <h2>2 —Ç–∞</h2>
                    </div>
                </div>
            </div>
        </div>

        <div id="scr-order" class="screen">
            <div class="card">
                <h1>–Ø–ù–ì–ò –ë–£–Æ–†–¢–ú–ê</h1>
                <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                    <div style="flex: 1;">
                        <label>–ú–∞—Ç–µ—Ä–∏–∞–ª —Ç—É—Ä–∏:</label>
                        <select id="mat-type">
                            <option value="2800x2070">–õ–î–°–ü –û“õ (2800x2070)</option>
                            <option value="2800x1220">–õ–ú–î–§ –ö—É–ª—Ä–∞–Ω–≥ (2800x1220)</option>
                        </select>
                    </div>
                    <div style="flex: 1;">
                        <label>–ö–µ—Å–∏—à “õ–∞–ª–∏–Ω–ª–∏–≥–∏ (–º–º):</label>
                        <input type="number" id="kerf" value="4">
                    </div>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>L (–£–∑—É–Ω–ª–∏–∫)</th>
                            <th>W (–≠–Ω–∏)</th>
                            <th>–°–æ–Ω–∏</th>
                            <th>–ö—Ä–æ–º–∫–∞ (L1, L2, W1, W2)</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="parts-list"></tbody>
                </table>
                <button class="btn" style="background: #475569; color: white; margin-top: 15px; width: auto;" onclick="addPartRow()">+ –î–µ—Ç–∞–ª “õ—û—à–∏—à</button>
                <button class="btn" style="margin-top: 20px;" onclick="generateRealisticNesting()">üìê –†–∞—Å–∫—Ä–æ–π–Ω–∏ “≥–∏—Å–æ–±–ª–∞—à</button>
            </div>
        </div>

        <div id="scr-nest" class="screen">
            <div class="card">
                <h1>–†–ê–°–ö–†–û–ô –•–ê–†–ò–¢–ê–°–ò</h1>
                <div id="nesting-output"></div>
                <div style="display: flex; gap: 20px; margin-top: 20px;">
                    <div class="card" style="flex:1; margin:0;">üì¶ –ñ–∞–º–∏ –ª–∏—Å—Ç: <b id="total-sheets">0</b> —Ç–∞</div>
                    <div class="card" style="flex:1; margin:0;">ü©π –ö—Ä–æ–º–∫–∞: <b id="total-edge">0</b> –º.–ø.</div>
                </div>
                <button class="btn" style="margin-top: 25px;" onclick="sendOrderToTelegram()">üöÄ –ë—É—é—Ä—Ç–º–∞–Ω–∏ —Ç–∞—Å–¥–∏“õ–ª–∞—à</button>
            </div>
        </div>

        <div id="scr-history" class="screen">
            <div class="card">
                <h1>–ë–£–Æ–†–¢–ú–ê–õ–ê–† –¢–ê–†–ò–•–ò</h1>
                <table>
                    <thead>
                        <tr><th>–°–∞–Ω–∞</th><th>ID</th><th>–ú–∞—Ç–µ—Ä–∏–∞–ª</th><th>–°—É–º–º–∞</th><th>–°—Ç–∞—Ç—É—Å</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>19.01.2026</td><td>#TAB-882</td><td>–õ–î–°–ü –û“õ</td><td>1,200,000</td><td>‚úÖ –¢–∞–π—ë—Ä</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <script>
        function showScr(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        function addPartRow() {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td><input type="number" class="l" value="600"></td>
                <td><input type="number" class="w" value="400"></td>
                <td><input type="number" class="q" value="1"></td>
                <td>
                    <input type="checkbox" class="e1" title="L1"> <input type="checkbox" class="e2" title="L2">
                    <input type="checkbox" class="e3" title="W1"> <input type="checkbox" class="e4" title="W2">
                </td>
                <td onclick="this.parentElement.remove()" style="cursor:pointer; color:red;">‚úñ</td>
            `;
            document.getElementById('parts-list').appendChild(tr);
        }

        // –†–ï–ê–õ–ò–°–¢–ò–ö –ö–é–ü –õ–ò–°–¢–õ–ò –†–ê–°–ö–†–û–ô –ê–õ–ì–û–†–ò–¢–ú–ò
        function generateRealisticNesting() {
            const matSize = document.getElementById('mat-type').value.split('x').map(Number);
            const SW = matSize[0], SH = matSize[1];
            const kerf = parseInt(document.getElementById('kerf').value);
            const output = document.getElementById('nesting-output');
            output.innerHTML = "";

            let allParts = [];
            document.querySelectorAll('#parts-list tr').forEach(row => {
                const l = parseInt(row.querySelector('.l').value);
                const w = parseInt(row.querySelector('.w').value);
                const q = parseInt(row.querySelector('.q').value);
                const edges = [row.querySelector('.e1').checked, row.querySelector('.e2').checked, row.querySelector('.e3').checked, row.querySelector('.e4').checked];
                for(let i=0; i<q; i++) allParts.push({l, w, edges});
            });

            // –ö–∞—Ç—Ç–∞ –¥–µ—Ç–∞–ª–ª–∞—Ä–Ω–∏ –æ–ª–¥–∏–Ω “õ—û–π–∏—à (Best Fit)
            allParts.sort((a,b) => (b.l * b.w) - (a.l * a.w));

            let sheetsCount = 0;
            let totalEdgeMeters = 0;

            while(allParts.length > 0) {
                sheetsCount++;
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const scale = 0.25;
                canvas.width = SW * scale; canvas.height = SH * scale;

                const label = document.createElement('div');
                label.className = 'sheet-num'; label.innerText = `${sheetsCount}-–õ–ò–°–¢ (${SW}x${SH})`;
                output.appendChild(label);
                output.appendChild(canvas);

                ctx.fillStyle = "white"; ctx.fillRect(0,0,canvas.width,canvas.height);
                
                let curX = 10, curY = 10, rowH = 0;
                let packedInThisSheet = [];
                let notPacked = [];

                for(let p of allParts) {
                    if(curX + p.l > SW - 10) { curX = 10; curY += rowH + kerf; rowH = 0; }

                    if(curY + p.w <= SH - 10) {
                        // –ß–∏–∑–∏—à
                        ctx.fillStyle = "rgba(212, 175, 55, 0.2)";
                        ctx.fillRect(curX*scale, curY*scale, p.l*scale, p.w*scale);
                        ctx.strokeStyle = "#334155"; ctx.strokeRect(curX*scale, curY*scale, p.l*scale, p.w*scale);
                        
                        // –ö—Ä–æ–º–∫–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∏
                        ctx.strokeStyle = "red"; ctx.lineWidth = 2;
                        if(p.edges[0]) { ctx.beginPath(); ctx.moveTo(curX*scale, curY*scale); ctx.lineTo((curX+p.l)*scale, curY*scale); ctx.stroke(); }
                        
                        totalEdgeMeters += (p.edges[0]?p.l:0 + p.edges[1]?p.l:0 + p.edges[2]?p.w:0 + p.edges[3]?p.w:0) / 1000;
                        
                        curX += p.l + kerf;
                        rowH = Math.max(rowH, p.w);
                    } else {
                        notPacked.push(p);
                    }
                }
                allParts = notPacked;
            }

            document.getElementById('total-sheets').innerText = sheetsCount;
            document.getElementById('total-edge').innerText = totalEdgeMeters.toFixed(2);
            showScr('scr-nest');
        }

        async function sendOrderToTelegram() {
            const sheets = document.getElementById('total-sheets').innerText;
            const edge = document.getElementById('total-edge').innerText;
            const msg = `üì¶ –Ø–ù–ì–ò B2B –ë–£–Æ–†–¢–ú–ê\nüë§ –ö–ª–∏–µ–Ω—Ç: –ú–µ–±–µ–ª—å—á–∏\nüî¢ –õ–∏—Å—Ç–ª–∞—Ä —Å–æ–Ω–∏: ${sheets} —Ç–∞\nü©π –ö—Ä–æ–º–∫–∞ –∂–∞–º–∏: ${edge} –º.–ø.`;
            
            await fetch(`https://api.telegram.org/bot7927717291:AAG4h_LbZoY-1s2y0_zzNoCFudrU7pPDNas/sendMessage?chat_id=1015769230&text=${encodeURIComponent(msg)}`);
            alert("–ë—É—é—Ä—Ç–º–∞ –∏—à–ª–∞–± —á–∏“õ–∞—Ä–∏—à–≥–∞ —é–±–æ—Ä–∏–ª–¥–∏!");
            showScr('scr-acc');
        }

        // –î–∞—Å—Ç–ª–∞–±–∫–∏ “õ–∞—Ç–æ—Ä–Ω–∏ “õ—û—à–∏—à
        addPartRow();
    </script>
</body>
</html>
